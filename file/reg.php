<script type="text/javascript">var email,    fam,    name,    ot,    phone,    cardStat,    emailStat,    famStat,    nameStat,    otStat,    phoneStat;$(function () {    // Email    $("#email").change(function () {        email = $("#email").val();        var expEmail = /^([a-z0-9_\.\-]{1,20})@([a-z0-9\.\-]{1,20})\.([a-z]{2,4})$/gi;        var resEmail = email.search(expEmail);        if (resEmail == -1) {            $("#msgbox-email").text("Неверный email").css("color", "red").fadeIn(400);            emailStat = 0;            buttonOnAndOff();        } else {            $.ajax({                url: "check.php",                type: "POST",                data: "email=" + email,                cache: false,                success: function (response) {                    if (response == "no") {                        $("#msgbox-email").text("Email занят").css({                            'color': 'red',                            'display': 'inline-block'}).fadeIn(400);                    } else {                        $("#msgbox-email").text("Email свободен").css({                            'color': 'green',                            'display': 'inline-block'}).fadeIn(400);                    }                }            });            emailStat = 1;            buttonOnAndOff();        }    });    $("#email").keyup(function () {        $("#msgbox-email").text("");    });    // Fam//    $("#fam").change(function () {//        fam = $("#fam").val();//        var expFam = /^[а-я-]{1,20}$/gi;//        var resFam = fam.search(expFam);//        if (resFam == -1) {//            $("#msgbox-fam").text("Неверная фамилия").css({//                'color': 'red',//                'display': 'inline-block'}).fadeIn(400);//            famStat = 0;//            buttonOnAndOff();//        } else {//            $("#msgbox-fam").text("√").css({//                'color': 'green',//                'display': 'inline-block'}).fadeIn(400);//            famStat = 1;//            buttonOnAndOff();//        }////    });//    $("#fam").keyup(function () {//        $("#msgbox-fam").text("");//    });    // Name    $("#name").change(function () {        name = $("#name").val();        var expName = /^[а-я-]{1,20}$/gi;        var resName = name.search(expName);        if (resName == -1) {            $("#msgbox-name").text("Неверное имя").css({                'color': 'red',                'display': 'inline-block'}).fadeIn(400);            nameStat = 0;            buttonOnAndOff();        } else {            $("#msgbox-name").text("√").css({                'color': 'green',                'display': 'inline-block'}).fadeIn(400);            nameStat = 1;            buttonOnAndOff();        }    });    $("#name").keyup(function () {        $("#msgbox-name").text("");    });    // Ot//    $("#ot").change(function () {//        ot = $("#ot").val();//        var expOt = /^[а-я-]{1,20}$/gi;//        var resOt = ot.search(expOt);//        if (resOt == -1) {//            $("#msgbox-ot").text("Неверное отчество").css({//                'color': 'red',//                'display': 'inline-block'}).fadeIn(400);//            otStat = 0;//            buttonOnAndOff();//        } else {//            $("#msgbox-ot").text("√").css({//                'color': 'green',//                'display': 'inline-block'}).fadeIn(400);//            otStat = 1;//            buttonOnAndOff();//        }////    });    $("#ot").keyup(function () {        $("#msgbox-ot").text("");    });    // Phone    $("#phone").change(function () {        phone = $("#phone").val();        var expPhone = /^[0-9]{1,10}$/g;        var resPhone = phone.search(expPhone);        if (resPhone == -1) {            $("#msgbox-phone").text("Неправильный номер").css({                'color': 'red',                'display': 'inline-block'}).fadeIn(400);            phoneStat = 0;            buttonOnAndOff();        } else {            $.ajax({                url: "check.php",                type: "POST",                data: "phone=" + phone,                cache: false,                success: function (response) {                    if (response == "no") {                        $("#msgbox-phone").empty().fadeOut(400);                        $("#msgbox-phone").text("Номер уже существует").css({                            'color': 'red',                            'display': 'inline-block'}).fadeIn(400);                    } else {                        $("#msgbox-phone").empty().fadeOut(400);                        $("#msgbox-phone").text("Номер не занят").css({                            'color': 'green',                            'display': 'inline-block'}).fadeIn(400);                    }                }            });            phoneStat = 1;            buttonOnAndOff();        }    });    $("#phone").keyup(function () {        $("#msgbox-phone").text("");    });    function buttonOnAndOff() {        if (phoneStat == 1 && nameStat == 1 ) {            $("#submit").removeAttr("disabled");        } else {            $("#submit").attr("disabled", "disabled");        }    }});</script><script>    function goBack() {        document.location = "/page/18";    }</script><?phpif( isset( $_GET['pay'] ) && $_GET['pay'] === 'success' ){    echo "<div class='vender_main'>Регистрация</div><div style=\"padding: 20px\"><div class=\"notify_box\" style=\"height:312px;\">Здравствуйте!<br>            Благодарим Вас за регистрацию на сайте www.freebonline.com.            Теперь Вы сможете получать огромные скидки в лучших заведениях Вашего города!            Так же не упустите возможность поучаствовать в наших розыгрышах.            Приглашайте как можно больше друзей, пишите комментарии и рецензии к акциям,            в которых участвовали, или просто пользуйтесь нашими БЕСПЛАТНЫМИ скидками и получайте за все это бонусы!            Подробнее обо всем этом Вы можете узнать на страничке \"Как это работает?\"<br>            Вы можете воспользоватся услугами интернет-магазинов по всей Украине!            После регистрации Вы можете привязать Вашу карточку в личном кабинете.<br>";}elseif( $_GET['status'] === 'wait_payment' && isset( $_GET['account_id'] ) ){    require_once( 'api/classes/LiqPayMerchant.php' );    $lpMerchant = new LiqPayMerchant;    $lpMerchant->setAccountId( $user_id )        ->setAmount( 2 )        ->setDescription( 'Оплата скидочной карты №' . convert_id( $user_id ) );    ?>    <div class="vender_main">Оплата аккаунта</div>    <div valign="top" align="center" style="margin: 20px 0;">        Вы уже зарегистрированны в системе, но Ваш аккаунт не оплачен.        <form action='<?php echo LiqPayMerchant::SERVICE_URL; ?>' method='post'>            <input type='hidden' name='operation_xml' value='<?php echo $lpMerchant->getEncodedXML(); ?>' />            <input type='hidden' name='signature' value='<?php echo $lpMerchant->getSignature(); ?>' />            <input type="submit" class="notify_btn" value="Оплатить">        </form>    </div><?php}elseif( $_POST[ 'regOn' ] ){    function random_password( $length = 8, $allow_uppercase = true, $allow_numbers = true ){        $out = '';        $arr = array();        for( $i = 97; $i < 123; $i++ )            $arr[ ] = chr( $i );        if( $allow_uppercase )            for( $i = 65; $i < 91; $i++ )                $arr[ ] = chr( $i );        if( $allow_numbers )            for( $i = 0; $i < 10; $i++ )                $arr[ ] = $i;        shuffle( $arr );        for( $i = 0; $i < $length; $i++ ){            $out .= $arr[ mt_rand( 0, sizeof( $arr ) - 1 ) ];        }        return $out;    }    // -- Переменная (должна быть private) прерывает работу скрипта, если возникает ошибка.    // -- может иметь только два значения 0 - все нормально, 1 - ошибка --    $error = 0;    // -- Проверяем дату на правильность --    if( $_POST[ 'date_m' ] !== 'Месяц' && $_POST[ 'date_y' ] !== 'Год' && $_POST[ 'date_d' ] !== 'День' ){        // -- Создание даты для занесения в базу данных --        $date          = new DateTime( $_POST[ 'date_m' ] . '/' . $_POST[ 'date_d' ] . '/' . $_POST[ 'date_y' ] );        $formattedDate = date_format( $date, 'Y-m-d' ); // -- дата будет вида 2012-12-21 --s        // -- Сейчас мы ищем тот же телефон или номер карточки, что есть в базе данных --        $sql = "SELECT `login` FROM `member`";        $query = mysql_query( $sql ) or die( mysql_error());        while( $row = mysql_fetch_row( $query ) ){            // -- И если находим такой же телефон или номер карточки, то выводим ошибку и останавливаем дальнейшее выполнение  --            if( $_POST[ 'mobile' ] == $row[ 0 ] ){                echo '<div class="notify_box" style="height:312px;"><p style="text-align: center;">Такой номер телефона уже существуют!</p>                <br><a href="javascript:void(0)" style="margin-left: 10px;" onclick="goBack();">Назад</a>';                $error = 1;            }        }    }    // -- Если прошли все проверки и нет ошибки тогда продолжаем --    if( $error != 1 ){        // -- Дополняем карточки родителя до 9 знаков заполняя нулями слева --        $password = random_password();        // -- И если все правильно тогда заносим данные --        $sqlIN = "INSERT INTO `member` (                `login` ,  `password`, `status`, `f_name` ,  `s_name` , `t_name` ,  `phone` , `birthday` ,                `email` , `balls` , `change_balls` , `saved_money` , `country` , `city` , `id` , `sex` , `datereg` ,                `all_balls` , `all_product` , `balance` , `diller` , `all_money` , `credit` ,  `money` ) VALUES ( '" .            $_POST[ 'mobile' ] . "',   '" .            md5( $password ) . "',  'wait_payment',  '" .            $_POST[ 'name' ] . "', '" .            $_POST[ 'ot' ] . "',   '" .            $_POST[ 'fam' ] . "',  '" .            $_POST[ 'mobile' ] . "', '" . $formattedDate . "', '" .            $_POST[ 'email' ] . "',  '0',  '0',  '0',  'Украина',  'Херсон',  '',  '" .            $_POST[ 'sex' ] . "',   '" . date( "Y-m-d H:i:s" ) . "', '0',  '0', '0',  '0',  '0',  '0',  '0' )";        $mysql_query = mysql_query( $sqlIN ) or die( mysql_error() );        // -- Само сообщение после регистрации --        $user_id = mysql_insert_id();        $codeGenerator = new CodeGenerator( $user_id );        $codeGenerator->run()->save();        require_once( 'api/classes/LiqPayMerchant.php' );        $lpMerchant = new LiqPayMerchant;        $lpMerchant->setAccountId( $user_id )            ->setAmount( 0.02 )            ->setDescription( 'Оплата скидочной карты №' . convert_id( $user_id ) );    ?>    <div class="vender_main">Регистрация. Шаг 2</div>    <p style="padding: 20px">        Ваш аккаунт создан в системе.<br>        <b style='font-size:16px;'>Ваш логин - это номер телефона, а пароль - <?php echo $password; ?></b><br>        Для того, чтоб его активировать, необходимо оплаить $2.<br>        Принимаюncz банковские карты MasterCard и VISA.<br>    </p>    <div valign="top" align="center" style="margin: 20px 0;">        <form action='<?php echo LiqPayMerchant::SERVICE_URL; ?>' method='post'>            <input type='hidden' name='operation_xml' value='<?php echo $lpMerchant->getEncodedXML(); ?>' />            <input type='hidden' name='signature' value='<?php echo $lpMerchant->getSignature(); ?>' />            <input type="submit" class="notify_btn" value="Оплатить">            <a href="javascript:void(0)" style="margin-left: 10px;" onclick="goBack();">Назад</a>        </form>    </div>    </div>        <?php    }}else{// -- Выводим всю информацию, если пользователь только зашел на страницу и ничего не отправлял --    ?>    <script type="text/javascript">        /* Скрипт проверки на пустоту заполненых данных. Если один из обязательных полей не заполнен, то нужно остановить         дальнейшее выполнение скрипта */        $(function () {            var field = new Array("name", "mobile");//поля обязательные            $("form").submit(function () {// обрабатываем отправку формы                var error = 0; // индекс ошибки                $("form").find(":input").each(function () {// проверяем каждое поле в форме                    for (var i = 0; i < field.length; i++) { // если поле присутствует в списке обязательных                        if ($(this).attr("name") == field[i]) { //проверяем поле формы на пустоту                            if (!$(this).val()) {// если в поле пустое                                $(this).css({'border': 'red 1px solid'});// устанавливаем рамку красного цвета                                error = 1;// определяем индекс ошибки                            }                            else {                                $(this).css('border', 'gray 1px solid');// устанавливаем рамку обычного цвета                            }                        }                    }                })                if (error == 0) { // если ошибок нет то отправляем данные                    return true;                }                else {                    if (error == 1) var err_text = "Не все обязательные поля заполнены";                    $("#messenger").html(err_text);                    $("#messenger").fadeIn("slow");                    return false; //если в форме встретились ошибки , не  позволяем отослать данные на сервер.                }            })        });    </script>    <!-- Сама таблиця с формацией -->    <div class="vender_main">Регистрация. Шаг 1</div>    <div class="notify_box" style="height:312px;">        <div class="notify_left">            <form method="post">                <table cellpadding="0" cellspacing="9" border="0">                    <tr>                        <td></td>                        <td>                            <div hidden="hidden" id="messenger"></div>                        </td>                    </tr>                    <tr>                        <td>Фамилия:</td>                        <td><input type="text" id=" " name="fam" class="notify_input" maxlength="50" value="">                            <span hidden="hidden" id="msgbox-fam"></span>                        </td>                    </tr>                    <tr>                        <td>Имя: <span style="color:red;">*</span></td>                        <td><input type="text" id="name" name="name" class="notify_input" maxlength="50" value=""/>                            <span hidden="hidden" id="msgbox-name"></span>                        </td>                    </tr>                    <tr>                        <td>Отчество:</td>                        <td><input type="text" name="ot" id="ot" class="notify_input" maxlength="50" value=""/>                            <span hidden="hidden" id="msgbox-ot"></span>                        </td>                    </tr>                    <tr>                        <td>Email:</td>                        <td><input type="text" id="email" name="email" class="notify_input" maxlength="50" value=""/>                            <span hidden="hidden" id="msgbox-email"></span>                        </td>                    </tr>                    <tr>                        <td>Дата рождения:</td>                        <td><select name="date_d">                                <option selected="selected">День</option>                                <?php                                for( $i = 1; $i <= 31; $i++ ){                                    echo '<option value=' . $i . '>' . $i . '</option>';                                }?>                            </select>                            <select name="date_m">                                <option selected="selected">Месяц</option><? for( $i = 1; $i <= 12; $i++ ){                                    echo '<option value=' . $i . '>' . $month[ $i ] . '</option>';                                }?></select>                            <select name="date_y">                                <option selected="selected">Год</option><? for( $i = 1999; $i >= 1920; $i-- ){                                    echo '<option value=' . $i . '>' . $i . '</option>';                                }?></select></td>                    </tr>                    <tr>                        <td>Пол:</td>                        <td><select name="sex">                                <option selected="selected" value="1">Мужской</option>                                <option value="0">Женский</option>                            </select></td>                    </tr>                    <tr>                        <td>Телефон: <span style="color:red;">*</span></td>                        <td width="500px">                            <input type="text" id="phone" name="mobile" class="notify_input" maxlength="10" value=""/>                            <span id="msgbox-phone">шаблон 050ххххххх</span>                        </td>                    </tr>                    <tr>                        <td></td>                        <td>                            Поля помеченные <span style="color:red;">*</span> обязательны к заполнению.                        </td>                    </tr>                    <tr>                        <td></td>                        <td style="padding-top:15px;">                            <input type="submit" name="regOn" value="Продолжить" class="notify_btn" id="submit" disabled="disabled">                        </td>                    </tr>                </table>            </form>        </div>    </div>    <div style="margin-top:50px;"></div><?php } ?>